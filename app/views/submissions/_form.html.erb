<% new_record = @submission.new_record? %>
<div class="contentpage_wrap">
  <%= form_for(@submission) do |f| %>
  <div class="contentpage_basic_mod_info_wrap uploadmod_basic_mod_info_wrap">
    <div class="contentpage_titlewrap">
      <%= f.text_field :name, class: 'uploadmod_title', placeholder: 'Title' %>
    </div>
    <div class="contentpage_mainthumb uploadmod_mainthumb">
      <img class="contentpage_mainthumb_img" src="<%= @submission.main_image ? @submission.main_image.image_url : 'mainplaceholder.png' %>" alt="Upload a Main Image" />
    </div>

  </div>
  <div class="contentpage_download_and_screenshots_wrap uploadmod_download_and_screenshots_wrap">
    <div class="uploadmod_buttons_wrap">
      <% if !new_record %>
      <a href="#file-popup" class='open-file'><input type="button" value="Add File" class="uploadmod_buttons" /></a>
      <% end %>
      <%= f.submit 'Save', class: 'uploadmod_buttons' %>
    </div>
    <div class="contentpage_screenshots_wrap uploadmod_screenshots_wrap">
      <div class='uploadmod_inner_screenshots_wrap'>
        <% if !new_record %>
        <% @submission.thumbnails.each do |thumb| %>
        <div class="uploadmod_individual_screenshot_wrap">
          <img src="<%= thumb.image_url(:thumb) %>" />
          <a href="<%= url_for [@submission, thumb] %>" class="close">&#10006;</a>
        </div>
        <% end %>
        <div class="uploadmod_individual_screenshot_wrap"><a href="#screenshot-popup" class='open-screenshot'><img class="uploadmod_addsceenshot" src="<%= asset_path('upload_thumb.png') %>" ></img></a></div>
        <% else %>
        <p align='center'>Save your submission before adding images or files!</p>
        <% end %>
      </div>
    </div>
  </div>

  <a class="expand_description">&#62;</a>
  <div class="contentpage_descriptionwrap uploadmod_descriptionwrap">
    <%= f.text_area :body, placeholder: 'Detailed mod description' %>
  </div>
  <div class="contentpage_commentswrap uploadmod_categorieswrap">
    <fieldset>
      <legend>Category</legend>
      <%= f.select(:category, options_for_select([['Tools', 'tools'], ['Maps', 'maps'], ['Vehicles', 'vehicles'], ['Textures', 'textures'], ['Script', 'script'], ['Misc', 'misc'], ['Weapons', 'weapons'], ['Player', 'player']], @submission.category), {}, {:class=>'maincategory', size: "8" }) %>
    </fieldset>
    <fieldset>
      <legend>SubCategory</legend>
      <%= f.select(:sub_category, options_for_select([['Ford', 'ford'], ['Maserati', 'maserati'], ['Nissan', 'nissan']], @submission.sub_category), {}, {:class=>'maincategory', size: "8" }) %>
    </fieldset>
  </div>
  <% end %>
</div>

<% if !new_record %>
<div class='upload_select' style='display: none;'>
  <%= select_tag :location, options_for_select([["Main Image", "Main"], ["Screenshot", "Thumbnail"]], "Thumbnail"), {} %>
</div>
<div id="screenshot-popup" class="imageupload_popup_wrap mfp-hide mfp-with-anim">
  <h3>Image Upload</h3>
  <h4>Drag and drop to upload more images!</h4>
  <table cellspacing="0" id="file-table"></table>

  <div class="progress-bar" style='display: none;'>
    <span style="width: 0%"></span>
  </div>

  <div class="bottom_buttons_wrap">
    <input class="upload" type=submit value="Upload" id="upload_btn" />
    <input id="fileupload" class="addimage" type="file" name="images[]" data-url="images.json" multiple value="Add Image">
  </div>
</div>

<div id="file-popup" class="popup mfp-hide mfp-with-anim">
  <p>Upload your files here. You <b>must</b> enter a version to represent this upload, but a changelog is <i>optional</i>.</p>

  <%= form_for [@submission, @submission.uploads.build] do |f| %>
  <p class='input-group'>
    <%= f.label :version %>
    <%= f.text_field :version %>
  </p>
  <p class='input-group'>
    <%= f.label :changelog %>
    <%= f.text_area :changelog %>
  </p>
  <p class='input-group'>
    <%= f.label :upload %>
    <%= f.file_field :upload %>
  </p>
  <p class='input-group'>
    <%= f.submit 'Upload' %>
  </p>
  <% end %>
</div>
<% end %>